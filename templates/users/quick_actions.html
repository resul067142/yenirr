{% extends 'layout/base.html' %}
{% block title %}Hızlı İşlemler - Cihaz Takip Sistemi{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">
    <div class="space-y-6">
        <!-- Page Header -->
        <div class="cyber-card">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold text-cyan-400">
                        <i class="fas fa-bolt mr-3"></i>
                        Hızlı İşlemler
                    </h1>
                    <p class="text-slate-400 mt-2">
                        Sık kullandığınız işlemleri üst şeride ekleyin ve hızlı erişim sağlayın
                    </p>
                </div>
                <div class="flex space-x-3">
                    <a href="{% url 'dashboard:home' %}" class="btn-cyber-secondary">
                        <i class="fas fa-arrow-left mr-2"></i>
                        Geri Dön
                    </a>
                </div>
            </div>
        </div>

        <!-- Add New Quick Action -->
        <div class="cyber-card">
            <h2 class="text-xl font-bold text-cyan-400 mb-4">
                <i class="fas fa-plus mr-2"></i>
                Yeni Hızlı İşlem Ekle
            </h2>
            
            <form method="post" class="space-y-4">
                {% csrf_token %}
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">İşlem Türü</label>
                        <select name="action" class="cyber-select w-full" required>
                            <option value="">Seçiniz...</option>
                            {% for action_value, action_label in available_actions %}
                                <option value="{{ action_value }}">{{ action_label }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">Görünen Ad</label>
                        <input type="text" name="display_name" class="cyber-input w-full" 
                               placeholder="Özel isim verin..." required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">İkon</label>
                        <input type="text" name="icon" class="cyber-input w-full" 
                               placeholder="fas fa-star" value="fas fa-star">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">Renk</label>
                        <select name="color" class="cyber-select w-full">
                            {% for color_value, color_label in color_choices %}
                                <option value="{{ color_value }}">{{ color_label }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                
                <div class="flex justify-end">
                    <button type="submit" class="btn-cyber-primary">
                        <i class="fas fa-plus mr-2"></i>
                        Hızlı İşlem Ekle
                    </button>
                </div>
            </form>
        </div>

        <!-- Current Quick Actions -->
        <div class="cyber-card">
            <h2 class="text-xl font-bold text-cyan-400 mb-4">
                <i class="fas fa-list mr-2"></i>
                Mevcut Hızlı İşlemler
            </h2>
            
            {% if user_quick_actions %}
            <div class="space-y-4">
                <div class="text-sm text-slate-400 mb-4">
                    <i class="fas fa-info-circle mr-2"></i>
                    İşlemleri sürükleyip bırakarak sıralayabilirsiniz
                </div>
                
                <div id="quickActionsContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                    {% for action in user_quick_actions %}
                    <div class="quick-action-item bg-slate-800 border border-slate-600 rounded-lg p-4 cursor-move hover:border-cyan-500 transition-colors"
                         data-action-id="{{ action.id }}">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center space-x-2">
                                <i class="fas fa-grip-vertical text-slate-500 cursor-move"></i>
                                <span class="text-xs text-slate-400">#{{ action.order|add:1 }}</span>
                            </div>
                            <a href="{% url 'users:quick_action_delete' action.id %}" 
                               class="text-red-400 hover:text-red-300 transition-colors"
                               onclick="return confirm('Bu hızlı işlemi silmek istediğinizden emin misiniz?')">
                                <i class="fas fa-trash"></i>
                            </a>
                        </div>
                        
                        <div class="text-center">
                            <div class="w-12 h-12 mx-auto mb-3 rounded-lg flex items-center justify-center {{ action.get_color_classes }}">
                                <i class="{{ action.icon }} text-lg"></i>
                            </div>
                            <h3 class="font-medium text-white mb-1">{{ action.display_name }}</h3>
                            <p class="text-sm text-slate-400">{{ action.get_action_display }}</p>
                        </div>
                        
                        <div class="mt-3 pt-3 border-t border-slate-600">
                            <a href="{{ action.get_url }}" class="btn-cyber-secondary w-full text-center text-sm">
                                <i class="fas fa-external-link-alt mr-2"></i>
                                Aç
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% else %}
            <div class="text-center py-8 text-slate-400">
                <i class="fas fa-bolt text-4xl mb-4"></i>
                <p class="text-lg">Henüz hızlı işlem eklenmemiş</p>
                <p class="text-sm">Yukarıdaki formu kullanarak ilk hızlı işleminizi ekleyin</p>
            </div>
            {% endif %}
        </div>

        <!-- Help Information -->
        <div class="cyber-card">
            <h3 class="text-lg font-semibold text-cyan-400 mb-3">
                <i class="fas fa-info-circle mr-2"></i>
                Nasıl Kullanılır?
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-slate-400">
                <div>
                    <p><strong>1. Hızlı İşlem Ekleme:</strong></p>
                    <ul class="list-disc list-inside mt-2 space-y-1">
                        <li>İşlem türünü seçin</li>
                        <li>Görünen adı belirleyin</li>
                        <li>İkon ve renk seçin</li>
                        <li>Kaydedin</li>
                    </ul>
                </div>
                <div>
                    <p><strong>2. Sıralama:</strong></p>
                    <ul class="list-disc list-inside mt-2 space-y-1">
                        <li>İşlemleri sürükleyip bırakın</li>
                        <li>Sıra otomatik kaydedilir</li>
                        <li>Üst şeritte bu sırada görünür</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Sortable.js for drag and drop -->
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const container = document.getElementById('quickActionsContainer');
    
    if (container) {
        new Sortable(container, {
            animation: 150,
            ghostClass: 'bg-cyan-900/50',
            chosenClass: 'bg-cyan-800/50',
            dragClass: 'bg-cyan-700/50',
            onEnd: function(evt) {
                const actionIds = Array.from(container.children).map(item => 
                    item.getAttribute('data-action-id')
                );
                
                // AJAX ile sıralamayı kaydet
                fetch('{% url "users:quick_action_reorder" %}', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                    },
                    body: 'action_ids[]=' + actionIds.join('&action_ids[]=')
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Sıra numaralarını güncelle
                        container.querySelectorAll('.quick-action-item').forEach((item, index) => {
                            const orderSpan = item.querySelector('span');
                            if (orderSpan) {
                                orderSpan.textContent = '#' + (index + 1);
                            }
                        });
                    }
                })
                .catch(error => console.error('Error:', error));
            }
        });
    }
});
</script>
{% endblock %}
