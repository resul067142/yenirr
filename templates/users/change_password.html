{% extends 'layout/base.html' %}

{% block title %}Şifre Değiştir - Cihaz Takip Sistemi{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto">
    <div class="space-y-6">
        <!-- Page Header -->
        <div class="bg-white rounded-lg shadow-sm p-6">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-2xl font-bold text-gray-900">
                        <i class="fas fa-key mr-3 text-blue-600"></i>
                        Şifre Değiştir
                    </h1>
                    <p class="text-gray-600 mt-1">Hesap güvenliği için şifrenizi güncelleyin</p>
                </div>
                <a href="{% url 'users:profile' %}" class="btn-secondary">
                    <i class="fas fa-arrow-left mr-2"></i>
                    Geri Dön
                </a>
            </div>
        </div>

        <!-- Password Change Form -->
        <div class="bg-white rounded-lg shadow-sm p-6">
            <form method="post" class="space-y-6">
                {% csrf_token %}
                
                <!-- Current Password -->
                <div>
                    <label for="{{ form.old_password.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                        {{ form.old_password.label }}
                    </label>
                    {{ form.old_password }}
                    {% if form.old_password.errors %}
                        <div class="mt-1 text-sm text-red-600">
                            {% for error in form.old_password.errors %}
                                <p>{{ error }}</p>
                            {% endfor %}
                        </div>
                    {% endif %}
                    {% if form.old_password.help_text %}
                        <p class="mt-1 text-sm text-gray-500">{{ form.old_password.help_text }}</p>
                    {% endif %}
                </div>

                <!-- New Password -->
                <div>
                    <label for="{{ form.new_password1.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                        {{ form.new_password1.label }}
                    </label>
                    {{ form.new_password1 }}
                    {% if form.new_password1.errors %}
                        <div class="mt-1 text-sm text-red-600">
                            {% for error in form.new_password1.errors %}
                                <p>{{ error }}</p>
                            {% endfor %}
                        </div>
                    {% endif %}
                    {% if form.new_password1.help_text %}
                        <div class="mt-2 p-3 bg-blue-50 rounded-lg">
                            <h4 class="text-sm font-medium text-blue-800 mb-2">Şifre Gereksinimleri:</h4>
                            <ul class="text-sm text-blue-700 space-y-1">
                                {% for help_text in form.new_password1.help_text %}
                                    <li class="flex items-center">
                                        <i class="fas fa-check mr-2 text-green-500"></i>
                                        {{ help_text }}
                                    </li>
                                {% endfor %}
                            </ul>
                        </div>
                    {% endif %}
                </div>

                <!-- Confirm New Password -->
                <div>
                    <label for="{{ form.new_password2.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                        {{ form.new_password2.label }}
                    </label>
                    {{ form.new_password2 }}
                    {% if form.new_password2.errors %}
                        <div class="mt-1 text-sm text-red-600">
                            {% for error in form.new_password2.errors %}
                                <p>{{ error }}</p>
                            {% endfor %}
                        </div>
                    {% endif %}
                    {% if form.new_password2.help_text %}
                        <p class="mt-1 text-sm text-gray-500">{{ form.new_password2.help_text }}</p>
                    {% endif %}
                </div>

                <!-- Form Actions -->
                <div class="flex justify-end space-x-3 pt-6 border-t border-gray-200">
                    <a href="{% url 'users:profile' %}" class="btn-secondary">
                        <i class="fas fa-times mr-2"></i>
                        İptal
                    </a>
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-save mr-2"></i>
                        Şifreyi Değiştir
                    </button>
                </div>
            </form>
        </div>

        <!-- Security Tips -->
        <div class="bg-blue-50 rounded-lg p-6">
            <div class="flex">
                <div class="flex-shrink-0">
                    <i class="fas fa-shield-alt text-blue-400 text-xl"></i>
                </div>
                <div class="ml-3">
                    <h3 class="text-sm font-medium text-blue-800">Güvenlik İpuçları</h3>
                    <div class="mt-2 text-sm text-blue-700">
                        <ul class="list-disc list-inside space-y-1">
                            <li>Güçlü bir şifre en az 8 karakter uzunluğunda olmalıdır</li>
                            <li>Büyük/küçük harf, rakam ve özel karakterler kullanın</li>
                            <li>Kişisel bilgilerinizi şifrede kullanmayın</li>
                            <li>Şifrenizi kimseyle paylaşmayın</li>
                            <li>Düzenli olarak şifrenizi değiştirin</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Password Strength Indicator -->
        <div class="bg-white rounded-lg shadow-sm p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">
                <i class="fas fa-chart-bar mr-2 text-green-600"></i>
                Şifre Gücü
            </h3>
            <div class="space-y-4">
                <div class="flex items-center space-x-2">
                    <div class="flex-1 bg-gray-200 rounded-full h-2">
                        <div id="passwordStrength" class="h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                    <span id="passwordStrengthText" class="text-sm font-medium text-gray-600">Zayıf</span>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="flex items-center space-x-2">
                        <div id="lengthCheck" class="w-4 h-4 rounded-full border-2 border-gray-300"></div>
                        <span class="text-sm text-gray-600">En az 8 karakter</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <div id="caseCheck" class="w-4 h-4 rounded-full border-2 border-gray-300"></div>
                        <span class="text-sm text-gray-600">Büyük/küçük harf</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <div id="numberCheck" class="w-4 h-4 rounded-full border-2 border-gray-300"></div>
                        <span class="text-sm text-gray-600">Rakam</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript for Password Strength -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const newPasswordInput = document.getElementById('{{ form.new_password1.id_for_label }}');
    const passwordStrength = document.getElementById('passwordStrength');
    const passwordStrengthText = document.getElementById('passwordStrengthText');
    const lengthCheck = document.getElementById('lengthCheck');
    const caseCheck = document.getElementById('caseCheck');
    const numberCheck = document.getElementById('numberCheck');

    function updatePasswordStrength(password) {
        let strength = 0;
        let checks = {
            length: password.length >= 8,
            case: /[a-z]/.test(password) && /[A-Z]/.test(password),
            number: /\d/.test(password)
        };

        // Update checkmarks
        lengthCheck.className = `w-4 h-4 rounded-full border-2 ${checks.length ? 'bg-green-500 border-green-500' : 'border-gray-300'}`;
        caseCheck.className = `w-4 h-4 rounded-full border-2 ${checks.case ? 'bg-green-500 border-green-500' : 'border-gray-300'}`;
        numberCheck.className = `w-4 h-4 rounded-full border-2 ${checks.number ? 'bg-green-500 border-green-500' : 'border-gray-300'}`;

        // Calculate strength
        if (checks.length) strength += 33;
        if (checks.case) strength += 33;
        if (checks.number) strength += 34;

        // Update strength bar
        passwordStrength.style.width = strength + '%';
        
        if (strength < 33) {
            passwordStrength.className = 'h-2 rounded-full transition-all duration-300 bg-red-500';
            passwordStrengthText.textContent = 'Zayıf';
            passwordStrengthText.className = 'text-sm font-medium text-red-600';
        } else if (strength < 66) {
            passwordStrength.className = 'h-2 rounded-full transition-all duration-300 bg-yellow-500';
            passwordStrengthText.textContent = 'Orta';
            passwordStrengthText.className = 'text-sm font-medium text-yellow-600';
        } else {
            passwordStrength.className = 'h-2 rounded-full transition-all duration-300 bg-green-500';
            passwordStrengthText.textContent = 'Güçlü';
            passwordStrengthText.className = 'text-sm font-medium text-green-600';
        }
    }

    if (newPasswordInput) {
        newPasswordInput.addEventListener('input', function() {
            updatePasswordStrength(this.value);
        });
    }
});
</script>
{% endblock %}
